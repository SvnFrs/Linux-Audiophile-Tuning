#!/bin/sh

usage () {
 echo "Usage: $(basename "$0") [qq|view]"
 echo "Scrape torrent movies"
}

chk_url () {
 printf "\n%s\n\n" $url
 if ! fping -q $(echo "$url" | cut -d\/ -f3-) 2>&1 && ! wget --spider -q "$url" 2>&1; then
  echo "The URL is not connected and exit!"
  exit
 fi
}

chk_movie () {
 if [ -z "$movie" ]; then
  echo "The movie is not found and exit!"
  exit
 else
 printf "%2d.%s\n" $i "$movie"
 fi
}

torwal () {
 url="https://torrentwal.com"
 chk_url
 for i in $(seq 1 10); do
  movie=$(curl -s -k "$url" | grep -o '영화</a> 인기자료.*' | sed 's/>[0-9]*\. <a href='\''\.\./\n/g' | head -$((i+1)) | tail -1 | cut -d'>' -f2 | cut -d'<' -f1 | sed 's/^[ \t]*//')
  chk_movie
  printf "     $url$(curl -s -k "$url" | grep -o '영화</a> 인기자료.*' | sed 's/>[0-9]*\. *<a href='\''\.\./\n/g' | head -$((i+1)) | tail -1 | cut -d\' -f1)\n"
 done
}

torqq () {
 url="https://토렌트큐큐.com"
#url="https://torrentqq32.com"
 chk_url
 [ -z "${url##*큐큐*}" ] && url="$(curl -s "$url" | grep -o href=.* | cut -d\" -f2)torrent/popular.html?period=d&board=mov"
 url="$url/torrent/popular.html?period=d&board=mov"
 for i in $(seq 1 10); do
  movie=$(curl -s "$url" | sed 's/title=/\n/g' | head -$((i+1)) | tail -1 | cut -d\" -f2)
  chk_movie
  printf "     $(curl -s "$url" | grep -o "http[s]://torrentqq[0-9]*.com/torrent/mov/[0-9]*.html" | head -$i | tail -1 | cut -d\" -f2)\n"
 done
}

torview () {
 url="https://torrentview12.net"
 chk_url
 url="$url/bbs/board.php?bo_table=mov"
 for i in $(seq 1 10); do
  movie=$(curl -s "$url" | grep -A 60 '인기 포스트' | grep '</a>' | head -$i | tail -1 | sed 's/ <\/a>//')
  chk_movie
  printf "     $(curl -s "$url" | grep -A 60 '인기 포스트' | grep '<a href=' | head -$i | tail -1 | cut -d\" -f2 | sed 's/\&amp;/\&/g')\n"
 done
}

if [ "$1" = qq ]; then
 torqq
elif [ "$1" = view ]; then
 torview
else
#torqq
 torview
fi

