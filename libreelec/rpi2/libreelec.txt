LibreELEC 9 (Libre Embedded Linux Entertainment Center)

1. Squashfs

  1.1 Unsquashfs

	$ wget http://archive.libreelec.tv/LibreELEC-RPi2.arm-9.2.0.img.gz
	$ mkdir ~/Downloads/libreelec/LibreELEC-RPi2.arm-9.2.0
	$ gzip -d LibreELEC-RPi2.arm-9.2.0.img.gz
	Mount LibreELEC image and copy SYSTEM to Downloads/libreelec/LibreELEC-RPi2.arm-9.2.0
	$ mv LibreELEC-RPi2.arm-9.2.0.img ~/Downloads/libreelec/LibreELEC-RPi2.arm-9.2.0/ && rm LibreELEC-RPi2.arm-9.2.0.img.gz
	$ cd Downloads/libreelec/LibreELEC-RPi2.arm-9.2.0
	$ mv SYSTEM SYSTEM.orig
	$ unsquashfs SYSTEM.orig
	$ [ ! -d copy  ] && mkdir copy
	$ cd squashfs-root

  1.2 ALSA

	$ cp /home/parkmino/git/audiophile/raspi/libasound.so.2.0.0.min ../copy/
	$ printf 'pcm.default.card 0 pcm.default.device 0 pcm.default.subdevice 0 pcm.default.type hw defaults.pcm.minperiodtime 2772 ctl.default ctl.9    ;  ' > ../copy/alsa.conf.min
	$ cp /home/parkmino/git/audiophile/alsa/alsa.conf.mix ../copy/
	$ sed -i '$d' ../copy/alsa.conf.mix
	$ printf 'pcm.default.card 0 pcm.default.device 0 pcm.default.subdevice 0 pcm.default.type hw defaults.pcm.minperiodtime 2772 ctl.default ctl.9    ;  ' >> ../copy/alsa.conf.mix

	$ mv usr/lib/libasound.so.2.0.0 usr/lib/libasound.so.2.0.0.orig
	$ cp ../copy/libasound.so.2.0.0.min ../copy/libasound.so.2.0.0.mix usr/lib/
	$ ln -sf /dev/shm/libasound.so.2.0.0 usr/lib/libasound.so.2.0.0
	$ ln -sf /dev/shm/libasound.so.2.0.0 usr/lib/libasound.so.2
	$ ln -sf /dev/shm/libasound.so.2.0.0 usr/lib/libasound.so
	$ cp usr/share/alsa/alsa.conf ../copy/alsa.conf.orig
	$ rm -rf usr/share/alsa && mkdir usr/share/alsa
	$ cp ../copy/alsa.conf.min ../copy/alsa.conf.mix ../copy/alsa.conf.orig usr/share/alsa/
	$ ln -sf /dev/shm/alsa.conf usr/share/alsa/alsa.conf
	
	$ sed -i '/^options snd-usb/s/^/#/' usr/lib/modprobe.d/alsa-base.conf
	$ nano usr/lib/modprobe.d/alsa-base.conf

  1.3 Kodi.bin

	$ sed -i '/^\/usr\/lib\/kodi\/kodi.bin/aexec /dev/shm/nohup /usr/lib/kodi/kodi.bin $SAVED_ARGS>/dev/null</dev/null 2>/dev/null' usr/lib/kodi/kodi.sh
	$ sed -i '/^\/usr\/lib\/kodi\/kodi.bin/s/^/#/' usr/lib/kodi/kodi.sh
	$ nano usr/lib/kodi/kodi.sh

  1.4 Patch

	$ cp bin/ps usr/bin/{chrt,nohup,taskset} hub-ctrl uhubctl llctl ../copy/
	$ cp lib/arm-linux-gnueabihf/libprocps.so.7.1.0 ../copy/libprocps.so.7
	$ cp /home/parkmino/git/audiophile/libreelec/{audio.conf,autostart.sh,sysctl.conf} ../

	$ rm usr/bin/ps usr/bin/nohup
	$ cp ../copy/{ps,chrt,nohup,taskset,hub-ctrl,uhubctl,llctl,audio-config} usr/bin/
	$ cp ../copy/*.pls ../copy/*.m3u etc/
	$ cp ../../kodi/plugin.{audio.kr2kodi,video.klive}.zip etc/
	$ cp ../copy/libprocps.so.7 usr/lib/
	$ cp ../{audio.conf,autostart.sh,sysctl.conf} etc/
	$ cp ../tuning_audio usr/lib/libreelec/
	$ cp ../tuning_audio.{service,target} usr/lib/systemd/system/
	$ ln -sf ../tuning_audio.service usr/lib/systemd/system/kodi.service.wants/tuning_audio.service
	$#[ ! -f usr/share/kodi/addons/skin.estuary/xml/Font.xml.orig ] && mv usr/share/kodi/addons/skin.estuary/xml/Font.xml usr/share/kodi/addons/skin.estuary/xml/Font.xml.orig && cp ../copy/Font.xml usr/share/kodi/addons/skin.estuary/xml/Font.xml

  1.6 Korean Transaltion

	$ https://www.transifex.com/libreelec/
	$#mkdir usr/share/kodi/addons/service.libreelec.settings/resources/language/resource.language.ko_kr
	$#cp ../copy/for_use_service_libreelec_settings_stringspo_ko.po usr/share/kodi/addons/service.libreelec.settings/resources/language/resource.language.ko_kr/strings.po

  1.7 SYSTEM to RAM

	$ mount -o remount,rw /flash
	$ sed -i '1s/$/toram /' /flash/cmdline.txt
	$ cat /flash/cmdline.txt
	$ reboot

  1.8 Mksquashfs

	$ cd ..
	$ [ -f SYSTEM ] && rm -f SYSTEM
	$ sudo mksquashfs squashfs-root SYSTEM -all-root -noappend

  1.9 Make image
	
	$ cp /home/parkmino/Downloads/libreelec/LibreELEC-RPi2.arm-9.2.0/LibreELEC-RPi2.arm-9.2.0.img /home/parkmino/Downloads/libreelec/LibreELEC-RPi2.arm-9.2.0/LibreELEC-RPi2.arm-9.2.0-audio.img
	$ fdisk -l /home/parkmino/Downloads/libreelec/LibreELEC-RPi2.arm-9.2.0/LibreELEC-RPi2.arm-9.2.0-audio.img
	$ sudo mkdir /mnt/le
	$ sudo mount -o loop,offset=$(echo $((512*8192))) /home/parkmino/Downloads/libreelec/LibreELEC-RPi2.arm-9.2.0/LibreELEC-RPi2.arm-9.2.0-audio.img /mnt/le
	$ sudo rm /mnt/le/SYSTEM*
	$ sudo cp SYSTEM /mnt/le
	$ sync
	$ sudo umount /mnt/le
	$ sudo rm -rf /mnt/le

2. Flashing

	$ sudo fdisk -l
	$ sudo umount /dev/sdc?
	$ sudo dd status=progress if=/home/parkmino/Downloads/libreelec/LibreELEC-RPi2.arm-9.2.0/LibreELEC-RPi2.arm-9.2.0-audio.img of=/dev/sdc
	$ sync
	
	$ mv /home/parkmino/Downloads/libreelec/LibreELEC-RPi2.arm-9.2.0/LibreELEC-RPi2.arm-9.2.0-audio.img /home/parkmino/Downloads/libreelec/LibreELEC-RPi2.arm-9.2.0/LibreELEC-RPi2.arm-9.2.0-audio-$(date +"%y.%m").img
	$ zip -j /home/parkmino/Downloads/libreelec/LibreELEC-RPi2.arm-9.2.0/LibreELEC-RPi2.arm-9.2.0-audio-$(date +"%y.%m").zip /home/parkmino/Downloads/libreelec/LibreELEC-RPi2.arm-9.2.0/LibreELEC-RPi2.arm-9.2.0-audio-$(date +"%y.%m").img

3. SSH login

	$ ssh root@192.168.0.x (password: libreelec)

4. More tweaks

	$ audio-config			# Disable USB signal & power
	$ nano .config/autostart.sh	# Disable hciattach systemd-journald/logind

cf)

https://github.com/soju6jan
Screenshots : Ctrl+S or 'kodi-send -a "TakeScreenshot"' or 'kodi-remote s'
