LibreELEC 9 (Libre Embedded Linux Entertainment Center)

1. Squashfs

  1.1 Unsquashfs

	$ mv SYSTEM SYSTEM.orig
	$ unsquashfs SYSTEM.orig
	$ [ ! -d copy  ] && mkdir copy
	$ cd squashfs-root

  1.2 ALSA

	$ mv usr/lib/libasound.so.2.0.0 usr/lib/libasound.so.2.0.0.orig
	$ cp /home/parkmino/git/audiophile/raspi/libasound.so.2.0.0.sav ../copy/libasound.so.2.0.0.min
	$ printf 'pcm.default pcm.0 pcm.0.type hw pcm.0.card 0 pcm.0.device 0 pcm.0.subdevice 0 pcm.0.sync_ptr_ioctl 1 pcm.0.nonblock 1 defaults.pcm.minperiodtime 2757 ctl.default /dev/mixer' > ../copy/alsa.conf.min
	$ cp /home/parkmino/git/audiophile/alsa/alsa.conf.mix ../copy/
	$ sed -i '$d' ../copy/alsa.conf.mix
	$ printf 'pcm.default pcm.0 pcm.0.type hw pcm.0.card 0 pcm.0.device 0 pcm.0.subdevice 0 pcm.0.sync_ptr_ioctl 1 pcm.0.nonblock 1 defaults.pcm.minperiodtime 2757 ctl.default /dev/mixer' >> ../copy/alsa.conf.mix

	$ cp ../copy/libasound.so.2.0.0.min usr/lib/
	$ ln -sf /dev/shm/libasound.so.2.0.0 usr/lib/libasound.so.2.0.0
	$ ln -sf /dev/shm/libasound.so.2.0.0 usr/lib/libasound.so.2
	$ ln -sf /dev/shm/libasound.so.2.0.0 usr/lib/libasound.so
	$ mv usr/share/alsa usr/share/alsa.orig
	$ mkdir usr/share/alsa
	$ cp ../copy/alsa.conf.min usr/share/alsa/
	$ cp ../copy/alsa.conf.mix usr/share/alsa/
	$ ln -sf /dev/shm/alsa.conf usr/share/alsa/alsa.conf
	$ sed -i '/^options snd-usb/s/^/#/' usr/lib/modprobe.d/alsa-base.conf

  1.3 Kodi.bin

	$ sed -i '/^\/usr\/lib\/kodi\/kodi.bin/a/dev/shm/nohup /usr/lib/kodi/kodi.bin>/dev/null</dev/null 2>/dev/null $SAVED_ARGS' usr/lib/kodi/kodi.sh
	$ sed -i '/^\/usr\/lib\/kodi\/kodi.bin/s/^/#/' usr/lib/kodi/kodi.sh

  1.4 Patch

	$ nano ../tuning_audio
	$ chmod +x ../tuning_audio

	#!/bin/sh
	# Audio patch
	if [ ! -e /storage/.config/audio_patched ]; then
	#sed -i '/boot=/s/quiet $/quiet consoleblank=0 elevator=noop selinux=0/' /flash/cmdline.txt
	#sed -i '/^disable_pvt=/s/^/^#/' /boot/config.txt
	 printf 'blacklist bcm2835_gpiomem\nblacklist fixed' > /storage/.config/modprobe.d/libreelec-blacklist.conf
	 cp /etc/sysctl.conf /storage/.config/sysctl.d/
	 cp /etc/audio.conf /etc/autostart.sh /storage/.config/
	 mkdir -p /storage/.kodi/userdata/playlists/music/kr2kodi/
         cp etc/*.py etc/*.m3u /storage/.kodi/userdata/playlists/music/kr2kodi/
	 touch /storage/.config/audio_patched
	#read -p "* Reboot to apply the audio tunings? [Y/n]" answer
	#[ "$answer" != n ] && reboot
	 echo "The audio tunings applied and rebooting ..."
	 sync
	 reboot -f
	fi

	$ echo '[Unit]
Description=Tuning Audio
DefaultDependencies=no

[Service]
Type=idle
ExecStart=/usr/lib/libreelec/tuning_audio
StandardInput=tty-force
StandardOutput=inherit
StandardError=inherit' > ../tuning_audio.service

	$ echo '[Unit]
Description=Tuning Audio
Requires=tuning_audio.service
After=tuning_audio.service
AllowIsolate=yes' > ../tuning_audio.target

	$ cp bin/ps usr/bin/{chrt,nohup,taskset} hub-ctrl llctl kr2url sbs_dec.py kbs sbs ut2kodi ../copy/
	$ rm usr/bin/ps usr/bin/nohup
	$ cp ../copy/{ps,chrt,nohup,taskset,hub-ctrl,llctl,kr2url,sbs_dec.py,kbs,sbs,ut2kodi} usr/bin/
	$ cp ../copy/{KBS*,MBC*,SBS*,*.m3u} etc/
	$ cp lib/arm-linux-gnueabihf/libprocps.so.6.0.0 ../copy/libprocps.so.6
	$ cp ../copy/libprocps.so.6 usr/lib/
	$ cp /home/parkmino/git/audiophile/libreelec/{audio.conf,autostart.sh,sysctl.conf} ../
	$ cp ../{audio.conf,autostart.sh,sysctl.conf} etc/
	$ cp ../tuning_audio usr/lib/libreelec/
	$ cp ../tuning_audio.service ../tuning_audio.target usr/lib/systemd/system/
	$ ln -sf ../tuning_audio.service usr/lib/systemd/system/kodi.service.wants/tuning_audio.service

  1.6 Korean Transaltion

	$ https://www.transifex.com/libreelec/
	$ mkdir usr/share/kodi/addons/service.libreelec.settings/resources/language/resource.language.ko_kr
	$ cp ../copy/for_use_service_libreelec_settings_stringspo_ko.po usr/share/kodi/addons/service.libreelec.settings/resources/language/resource.language.ko_kr/strings.po

  1.7 Mksquashfs

	$ cd ..
	$ [ -f SYSTEM ] && rm -f SYSTEM
	$ sudo mksquashfs squashfs-root SYSTEM

2. Flashing

	$ sudo fdisk -l
	$ sudo umount /dev/sdc?
	$ sudo dd status=progress if=/home/parkmino/Downloads/libreelec/LibreELEC-RPi2.arm-8.95.001/LibreELEC-RPi2.arm-8.95.001.img of=/dev/sdc
	$ sync
	$ mv /media/parkmino/LIBREELEC/SYSTEM /media/parkmino/LIBREELEC/SYSTEM.orig
	$ cp /home/parkmino/Downloads/libreelec/LibreELEC-RPi2.arm-8.95.001/SYSTEM /media/parkmino/LIBREELEC/SYSTEM
	$ sync
	$ sudo umount /dev/sdc?

3. SSH login

	$ ssh root@192.168.0.x (password: libreelec)

4. More tweaks

	$ nano /flash/cmdline.txt
	$ nano /storage/.config/audio.conf
	$ nano /storage/.config/autostart.sh
	$ cp -r ../video/* /storage/.kodi/userdata/playlists/video/

cf)

https://notepad-plus-plus.org/

https://github.com/soju6jan

Screenshots
Ctrl+S or 'kodi-send -a "TakeScreenshot"' or 'kodi-remote s'

# nano KBS\ 1FM.py

import subprocess, xbmc, xbmcgui

url = subprocess.check_output ('/usr/bin/kr2url 1fm' , shell=True)

listitem = xbmcgui.ListItem('KBS Classic FM')
xbmc.Player().play(url, listitem)

import urllib

u = urllib.urlopen("http://onair.kbs.co.kr/index.html?sname=onair&stype=live&ch_code=24").read()
