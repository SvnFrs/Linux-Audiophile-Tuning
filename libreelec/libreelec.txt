LibreELEC (Libre Embedded Linux Entertainment Center)

1. Unsquashfs & mksquashfs

	$ mv SYSTEM SYSTEM.orig
	$ unsquashfs SYSTEM.orig
	$ cd squashfs-root
	  ALSA tweak
	$ printf 'pcm.default pcm.0 pcm.0.type hw pcm.0.card 0 pcm.0.device 0 pcm.0.subdevice 0 pcm.0.sync_ptr_ioctl 1 pcm.0.nonblock 1 defaults.pcm.minperiodtime 2757 ctl.default /dev/mixer' > /home/parkmino/Downloads/LibreELEC-RPi2.arm-8.0.2/SYSTEM/squashfs-root/usr/share/alsa/alsa.conf.sav
	$ nano usr/lib/modprobe.d/alsa-base.conf
		#options snd-usb-audio index=-2
	  Kodi.bin tweak
	$ nano /home/parkmino/Downloads/LibreELEC-RPi2.arm-8.0.2/SYSTEM/squashfs-root/usr/lib/kodi/kodi.sh
		nohup /usr/lib/kodi/kodi.bin>/dev/null</dev/null 2>/dev/null
	$ cp bin/ps usr/bin/
	$ cp lib/arm-linux-gnueabihf/libprocps.so.3.0.0 usr/lib/
	$ cp chrt taskset hub-ctrl llctl usr/bin/
	$ mv usr/lib/libasound.so   usr/lib/libasound.so.orig
	$ mv usr/lib/libasound.so.2 usr/lib/libasound.so.2.orig
	$ ln -s /dev/shm/libasound.so.2.0.0 usr/lib/libasound.so.2.0.0
	$ ln -s /dev/shm/libasound.so.2.0.0 usr/lib/libasound.so.2
	$ ln -s /dev/shm/libasound.so.2.0.0 usr/lib/libasound.so
	$ mv usr/share/alsa/alsa.conf usr/share/alsa/alsa.conf.sav
	$ ln -s /dev/shm/alsa.conf usr/share/alsa/alsa.conf
	$ cd ..
	$ sudo mksquashfs squashfs-root SYSTEM

	$ mount
	$ sudo umount /dev/sdc?
	$ sudo dd if=LibreELEC-RPi2.arm-8.0.2.img of=/dev/sdc
	$ mv SYSTEM SYSTEM.orig
	$ cp SYSTEM SYSTEM

2. Boot configuration

	$ sudo nano /boot/cmdline.txt
		... consoleblank=0 elevator=noop selinux=0 # iv6.disable=1
	$ sudo nano /boot/config.txt
		#disable_pvt=1

3. SSH login

	$ ssh root@192.168.0.x (password: libreelec)

4. Disable modules

	# lsmod
	# nano ~/.config/modprobe.d/libreelec-blacklist.conf
		blacklist bcm2835_gpiomem
		blacklist fixed

5. Sysctl.conf

	# nano ~/.config/sysctl.d/sysctl.conf

6. Autostart.sh

	# nano /storage/.config/autostart.sh
	# chmod +x /storage/.config/autostart.sh

7. Patch

	$ nano /home/parkmino/Downloads/LibreELEC-RPi2.arm-8.0.2/SYSTEM/squashfs-root/etc/profile

	if [ ! -e /storage/.config/not_first ]; then
	 sed -i '/...$/s/.../... consoleblank=0 elevator=noop selinux=0/' /boot/cmdline.txt
	 sed -i '/^disable_pvt=/s/^/^#/' /boot/config.txt
	 printf 'blacklist bcm2835_gpiomem\nblacklist fixed' > ~/.config/modprobe.d/libreelec-blacklist.conf
	 cp /etc/sysctl.conf ~/.config/sysctl.d/sysctl.conf
	 cp /etc/autostart.sh /storage/.config/autostart.sh
	 touch /storage/.config/not_first
	 read -p "* Reboot to apply the patch? [Y/n]" answer
	 [ "$answer" != n ] && reboot
	fi

	$ cp /home/parkmino/git/audiophile/libreelec/sysctl.conf  /home/parkmino/Downloads/LibreELEC-RPi2.arm-8.0.2/SYSTEM/squashfs-root/etc/
	$ cp /home/parkmino/git/audiophile/libreelec/autostart.sh /home/parkmino/Downloads/LibreELEC-RPi2.arm-8.0.2/SYSTEM/squashfs-root/etc/
