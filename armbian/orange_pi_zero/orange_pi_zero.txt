==============
Orange Pi Zero
==============

01. Orange Pi

	http://www.orangepi.org/
	http://www.orangepi.org/orangepizero/
	http://linux-sunxi.org/Xunlong_Orange_Pi_Zero
	http://linux-sunxi.org/Fex_Guide

02. Armbian or DietPi

	https://www.armbian.com/
	https://www.armbian.com/orange-pi-zero/
	https://docs.armbian.com
	$ sudo fdisk -l
	$ sudo dd if=Armbian_5.25_Orangepizero_Ubuntu_xenial_default_3.4.113.img of=/dev/sdb
	$ sync
	$ ssh root@192.168.0.x password:1234
	Change password to "orangepi"
	# apt-get purge unattended-upgrades
	# apt-get update
	# apt-get upgrade
	# apt-get dist-upgrade
	# apt-get autoremove

03. DietPi

	http://www.dietpi.com
	http://dietpi.com/phpbb/viewtopic.php?f=8&t=9#p9
	http://dietpi.com/downloads/images/DietPi_OrangePiZero-armv7-(Jessie).7z
	$ sudo fdisk -l
	$ sudo dd if=DietPi_v145_OrangePiZero-armv7-(Jessie).img of=/dev/sdb
	$ sync
	$ ssh root@192.168.0.x password:dietpi

03. Initial Configuration

	$ ssh root@192.168.0.x password:1234
	Change password to "orangepi"
	# apt-get purge unattended-upgrades
	# apt-get update
	# apt-get upgrade
	# apt-get dist-upgrade
	# apt-get autoremove
	# dpkg-reconfigure tzdata	

04. Kernel Option

	# ls /boot/script.bin

	Armbian
	# cd /boot/bin
	# cp orangepizero.bin custom.bin
	# bin2fex custom.bin custom.fex
	# nano custom.fex
	# fex2bin custom.fex custom.bin
	# cd /boot
	# ln -sf /boot/bin/custom.bin /boot/script.bin

	DiePi
	# cd /boot
	# bin2fex script.bin script.fex
	# mv script.bin script.orig
	# nano script.fex
	# fex2bin script.fex script.bin

	# cat boot.cmd
	# nano armbianEnv.txt
		verbosity=1
		console=none
		extraargs="elevator=noop selinux=0"
	# reboot

05. Edit fstab

	# nano /etc/fstab
		/dev/sda1 /mnt ext4 ro 0 0
		#tmpfs /tmp tmpfs defaults,nosuid 0 0
		#/var/swap none swap sw 0 0
	# swapon -s

06. Remove modules

	# lsmod
	# nano /etc/modprobe.d/orangepizero.conf
		blacklist pcf8591
		blacklist bmp085
		blacklist xradio_wlan
		blacklist g_serial
		#blacklist btrfs

07. /etc/sysctl.conf

08. /etc/rc.local

09. ALSA

	# nano /usr/share/alsa/alsa.conf
		pcm.sound.card 1
		ctl.control.card 1
	# mv libasound.so.2 libasound.so.2.sav
	# mv libasound.so.2.0.0 libasound.so.2.0.0.sav
	# ln -sf /dev/shm/libasound.so.2.0.0 /usr/lib/arm-linux-gnueabihf/libasound.so.2

10. MPD

	$ sudo cp mpd /usr/bin
	$ sudo cp icon.png /root

	# apt-get install mpc ncmpc
	# mv mpd /usr/bin/ && mv mpd.conf /etc/
	# nano /etc/mpd.conf

	# apt-get install libcue1 libaudiofile1 libavformat-dev libflac8 libmad0 libid3tag0 libmpdclient2 libupnp6

11. Upmpdcli

12. USB IRQ

	# cat /proc/interrupts
	# nano /etc/rc.local
		 until $(grep -q usb1 /proc/interrupts); do
		  sleep 1
		 done
		 sleep 1

		 for i in $(awk '/usb1/{print +$1}' /proc/interrupts); do
		  echo $(echo "2^$m_task" | bc) > /proc/irq/$i/smp_affinity
		 done

13. USB auto mount

	https://wiki.archlinux.org/index.php/Fstab#External_devices

	# mkdir /mnt/usb
	# ln -s /mnt /var/lib/mpd/music
	# nano /etc/fstab
		 /dev/sda1 /mnt/usb auto defaults,nofail,x-systemd.device-timeout=1,ro 0 2
		#/dev/sda1 /mnt/usb vfat    ro 0 0
		#/dev/sda1 /mnt/usb ntfs-3g ro 0 0
	# nano /etc/rc.local
		systemd-udevd
	# systemctl daemon-reload
	# systemctl restart remote-fs.target
	# systemctl restart local-fs.target

14. Static IP

	# cp /etc/network/interfaces.default /etc/network/interfaces
	# nano /etc/network/interfaces
		auto  eth0
		#iface eth0 inet manual
		iface eth0 inet static
			address		192.168.0.3
			netmask		255.255.255.0
			broadcast	192.168.0.255
			network		192.168.0.0
			gateway		192.168.0.1 
			dns-nameservers 168.126.63.1
	# systemctl disable network-manager.service

15. Show release

	# echo "* Mino's UPnP Audio Renderer for Orang Pi Zero 17.06" > release

16. Make Image

	# nano ~/release
	# mpc clear
	# rm -f ~/.bash_history ; history -c
	# poweroff

	$ sudo fdisk -l
	$ sudo dd bs=4M if=/dev/sdb of=orange_pi_zero_audio_renderer_17.06.img
	$ zip orange_pi_zero_audio_renderer_17.06.zip orange_pi_zero_audio_renderer_17.06.img
