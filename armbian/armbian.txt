==============
Orange Pi Mini
==============

1. Orange Pi

	http://www.orangepi.org/
	http://www.orangepi.org/orangepimini/index.html
	Orange Pi vs Raspberry Pi 2
		High performance GPU, RAM, LAN
		Additional Wireless LAN, SATA(to USB), Microphone, IR, OTG
		Dedicated IRQs for LAN and USB

2. Orange Pi Download

	http://www.orangepi.org/downloadresources/

3. Armbian Install (Debian Wheezy,Jessie and Ubuntu Trusty by Igor Pečovnik)

	http://www.armbian.com/
	http://www.armbian.com/orange-pi-mini/
	http://www.armbian.com/documentation/
	https://github.com/igorpecovnik/lib/blob/second/documentation/user-faq.md
	# cat /proc/partitions
	# sudo fdisk -l
	# unzip Armbian_4.2_Orangepi_Debian_jessie_4.1.6.zip
	# sudo dd bs=4M if='Armbian_4.2_Orangepi_Debian_jessie_4.1.6.raw' of=/dev/sdb
	# sudo sync

4. Initial Configuration

	"First run"
	Wait around three minutes to reboot after package list updates, swap partitioning, SSH key generation and partition expansion
	Reboot
	# ssh root@192.168.0.5 password:1234
	Change password
	USB Tweak for Orane Pi Mini
	# lsusb && cat /proc/interrupts | grep usb
조	# mv /boot/dtb/sun7i-a20-orangepi.dtb /boot/dtb/sun7i-a20-orangepi.dtb.org
	# cp /boot/dtb/sun7i-a20-orangepi-mini.dtb /boot/dtb/sun7i-a20-orangepi.dtb
	# apt-get update
	# apt-get upgrade
	# (apt-get dist-upgrade)
	# dpkg-reconfigure locales
	# dpkg-reconfigure tzdata
	# lsmod
	# nano /etc/modprobe.d/opi-blacklist.conf
		blacklist evbug
		blacklist evdev
		(blacklist sun4i_ts)
	# systemctl disable lirc.service
	# (systemctl disable cron.service)	
	# nano /etc/fstab
		tmpfs ...
	# cat /proc/interrupts
	# cat /etc/fstab
	
5. NFS Server

	# fdisk -l
	# apt-get install nfs-kernel-server (nfs-common portmap)
	# (mkdir /mnt/Music)
	# (chown nobody:nogroup /mnt/Music)
	# (chmod -R 777 /mnt/Music)
	# nano /etc/fstab
		/dev/sda1 /mnt ext4 ro 0 0
	# nano /etc/exports
		/mnt/Music 192.168.0.5/(ro,no_subtree_check,no_root_squash)
	# reboot (/etc/init.d/nfs-kernel-server restart)
	# (/etc/init.d/portmap restart)
	# rpcinfo -p
	
6.rc.local
	# nano /etc/rc.local
		sysctl -w kernel.sched_rt_runtime_us=-1
		sysctl -w kernel.sched_rt_period_us=42700
		sysctl -w kernel.printk='4 4 1 4'
		sysctl -w vm.swappiness=0
		sysctl -w vm.overcommit_memory=1
		sysctl -w vm.overcommit_ratio=100
		sysctl -w vm.dirty_writeback_centisecs=0
		sysctl -w vm.oom_dump_tasks=0
		sysctl -w vm.oom_kill_allocating_task=1
		sysctl -w vm.panic_on_oom=2
		sysctl -w vm.stat_interval=3
		sysctl -w vm.user_reserve_kbytes=0

		ifconfig eth0  txqueuelen 10000
		ifconfig wlan0 txqueuelen 10000

		sysctl -w net.core.rmem_max=12582912
		sysctl -w net.core.wmem_max=12582912
		sysctl -w net.ipv4.conf.default.forwarding=1
		sysctl -w net.ipv4.tcp_rmem='10240 87380 12582912'
		sysctl -w net.ipv4.tcp_wmem='10240 87380 12582912'
		sysctl -w net.ipv4.tcp_timestamps=0
		sysctl -w net.ipv4.tcp_window_scaling=1
		sysctl -w net.ipv4.tcp_sack=0
		sysctl -w net.ipv4.tcp_no_metrics_save=1
		sysctl -w net.core.netdev_max_backlog=5000
		sysctl -w net.ipv6.conf.all.disable_ipv6=1
		
		echo none > /sys/class/leds/orangepi\:green\:usr/trigger

		#PIDS=`ps h -eo pid,class,comm | awk '$3 ~ /nfsd/ && $3 !~ /nfsd4/ {print $1}'`
		#for PID in ${PIDS}
		#do
		#    taskset -acp 1 ${PID}
		#done

7. Hdparm

	# nano /etc/hdparm.conf
		#read_ahead_sect = 256
		lookahead = off
		apm = 255
	# hdparm -A -a -B /dev/sda

8. No swap

	# swapon -s
	# swapoff /dev/sda
	# sudo nano /etc/fstab
		#/var/swap none swap sw 0 0
		
9. Masking store/restore alsa mixer

우	# systemctl mask alsa-store.service
	
10. MPD CLI Clients

	# apt-get install mpc ncmpc fbterm unifont
	# nano /etc/profile.d/export.sh
		#!/bin/bash
		export MPD_HOST=192.168.0.3
	# mkdir ~/.ncmpc
	# nano ~/.ncmpc/config
		host = 192.168.0.3
		enable-mouse = no
		#display-time = yes
		enable-colors = yes

11. Wireless Bridge Mode

	/usr/sbin/hostapd(-rt)
	/etc/hostapd.conf(-rt)
	# ln -sf /etc/network/interfaces.hostapd /etc/network/interfaces
	# nano /etc/network/interfaces
		auto  lo br0
		iface lo inet loopback
		
		allow-hotplug eth0
		iface eth0 inet manual
		
		allow-hotplug wlan0
		iface wlan0 inet manual

		iface br0 inet static
			bridge_ports	eth0 wlan0
			address 	192.168.0.5
			netmask 	255.255.255.0
			broadcast 	192.168.0.255
			network 	192.168.0.0
			gateway 	192.168.0.1 
			dns-nameservers 168.126.63.1
	# nano /etc/init.d/hostapd
		DAEMON_SBIN=/usr/sbin/hostapd-rt
		DAEMON_CONF=/etc/hostapd.conf-rt
	# nano /etc/hostapd.conf-rt
		ssid=xxx
		wpa_passphrase=xxx

12. (Install Create_ap)

	Debian Bridge
		https://wiki.debian.org/BridgeNetworkConnections
	# sudo nano /etc/network/interfaces
		auto  lo br0
		iface lo inet loopback
		
		iface eth0 inet manual
		
		iface wlan0 inet manual

		iface br0 inet static
			bridge_ports	eth0 wlan0
			address 	192.168.0.5
			netmask 	255.255.255.0
			broadcast 	192.168.0.255
			network 	192.168.0.0
			gateway 	192.168.0.1 
			dns-nameservers 168.126.63.1
	# wget https://github.com/oblique/create_ap/archive/master.zip
	# unzip master.zip
	# cd create_ap-master
	# apt-get install bash util-linux procps (hostapd) iproute2 iw  haveged dnsmasq iptables make
	# make install
	# sudo nano /etc/rc.local
		create_ap -m bridge -c? --daemon --hidden wlan0 br0 orangepi
		create_ap -m bridge --no-virt --driver r8188eu --daemon wlan0 br0 orangepi

==============
Raspberry Pi 2
==============

1. Raspberry Pi 2

	# remountrw
	# (sudo apt-get install nfs-common)
	# sysv-rc-conf
		nfs-common	  2 3 4 5 S
	# nano /etc/mpd.conf
		bind_to_address	"any" or "192.168.0.3" "192.168.0.5"
	# nano /etc/fstab
		192.168.0.5:/mnt/Music /mnt/Music nfs ro,sync,hard,intr,rsize=8192,iocharset=utf8 0 0
