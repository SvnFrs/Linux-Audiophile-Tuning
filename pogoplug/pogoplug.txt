The latest U-Boot Bootloader
U-Boot 2016.05-tld-1
http://forum.doozan.com/read.php?3,12381

Linux Kernel 4.10.0 Kirkwood package and Debian rootfs
http://forum.doozan.com/read.php?2,12096
Debian 4.4.0 kirkwood rootfs
Debian-4.4.0-kirkwood-tld-1-rootfs-bodhi.tar.bz2

1. USB Install

$ sudo gparted (a single ext2 partition with 'rootfs' label)
$ sudo apt-get install u-boot-tools
$ sudo su
# fdisk -l
# cd /media/parkmino/rootfs
# tar -xjf '/home/parkmino/Downloads/Debian-4.4.0-kirkwood-tld-1-rootfs-bodhi.tar.bz2'
# nano /media/parkmino/rootfs/etc/fstab
	/dev/root / ext2  noatime,errors=remount-ro 0 1

# cd boot
# cp -a zImage-4.4.0-kirkwood-tld-1  zImage.fdt
# cat dts/kirkwood-pogo_e02.dtb >> zImage.fdt
# mv uImage uImage.orig
# mkimage -A arm -O linux -T kernel -C none -a 0x00008000 -e 0x00008000 -n Linux-4.4.0-kirkwood-tld-1 -d zImage.fdt  uImage
# sync

# cp -a zImage-4.4.0-kirkwood-tld-1  zImage.fdt
# cat dts/kirkwood-pogoplug_v4.dtb >> zImage.fdt
# mkimage -A arm -O linux -T kernel -C none -a 0x00008000 -e 0x00008000 -n Linux-4.4.0-kirkwood-tld-1 -d zImage.fdt  uImage.v4
# sync

# exit

2. USB Boot

$ ssh root@192.168.0.x (password: root)
# rm /etc/ssh/ssh_host*
# ssh-keygen -A
# apt-get update
# apt-get upgrade	# CAUTION : It may not reboot for some reason !
  ...
  update-initramfs: Generating /boot/initrd.img-4.4.0-kirkwood-tld-1
# cd /boot
# mkimage -A arm -O linux -T ramdisk -C gzip -a 0x00000000 -e 0x00000000 -n initramfs-4.4.0-kirkwood-tld-1 -d initrd.img-4.4.0-kirkwood-tld-1 uInitrd
# apt-get dist-upgrade
# apt-get autoremove
# apt-get clean
# date
# dpkg-reconfigure tzdata
# date
# lsmod
# nano /etc/modprobe.d/blacklist

3. ALSA & MPD

# apt-get install alsa-base alsa-utils mpd mpc ncmpc ca-certificates curl psmisc # cifs-utils
# mv /usr/lib/arm-linux-gnueabi/alsa-lib/smixer/smixer-ac97.so /usr/lib/arm-linux-gnueabi/alsa-lib/smixer/smixer-ac97.so.sav
# mv /usr/lib/arm-linux-gnueabi/alsa-lib/smixer/smixer-sbase.so /usr/lib/arm-linux-gnueabi/alsa-lib/smixer/smixer-sbase.so.sav
# mv /usr/lib/arm-linux-gnueabi/alsa-lib/smixer/smixer-hda.so /usr/lib/arm-linux-gnueabi/alsa-lib/smixer/smixer-hda.so.sav

https://packages.debian.org/search?keywords=mpd
# wget http://ftp.us.debian.org/debian/pool/main/m/mpd/mpd_0.19.12-1~bpo8+1_armel.deb
# dpkg -i mpd*.deb

# mv /etc/mpd.conf /etc/mpd.conf.orig
# nano /etc/mpd.conf

4. Upmpdcli Build

# apt-get install autoconf automake build-essential libtool pkg-config
# apt-get install libupnp6-dev libexpat1-dev libmpdclient-dev libcurl4-gnutls-dev libmicrohttpd-dev libjsoncpp-dev
# cd
# wget https://www.lesbonscomptes.com/upmpdcli/downloads/libupnpp-0.16.1.tar.gz
# tar -xvf libupnpp-0.16.1.tar.gz
# cd libupnpp-0.16.1
# ./configure
# make
# make install
# cd
# wget https://www.lesbonscomptes.com/upmpdcli/downloads/upmpdcli-1.2.16.tar.gz
# tar -xvf upmpdcli-1.2.16.tar.gz
# cd upmpdcli-1.2.16
# ./configure
# make
# make install
# adduser upmpdcli
# cp ~/icon.png /usr/local/share/upmpdcli/
# cd
# nano /usr/local/etc/upmpdcli.conf
	checkcontentformat = 0

5. Remove Services

# nano /etc/inittab
	#... ttyS0
# apt-get install sysv-rc-conf
# sysv-rc-conf
	Remove alsa-utils(S) avahi-daemon(2-3-4-5) busybox-klogd(2-3-4-5) busybox-syslogd(2-3-4-5) mpd(2-3-4-5)

6. Fstab

# nano /etc/fstab
# mkdir /mnt/usb01 /mnt/usb02 /mnt/pc01 /mnt/pc02 /mnt/nas01 /mnt/nas02
# ln -s /mnt /var/lib/mpd/music

### /etc/fstab from Voyage MPD
/dev/hda1 / ext2 defaults,noatime,rw 0 0
proc /proc proc defaults 0 0
tmpfs /tmp tmpfs nosuid,nodev 0 0

7. Rc.local

# mv /usr/lib/arm-linux-gnueabi/libasound.so.2.0.0 /usr/lib/arm-linux-gnueabi/libasound.so.2.0.0.sav
# mv /usr/share/alsa/alsa.conf /usr/share/alsa/alsa.conf.sav
# mv /etc/mpd.conf /etc/mpd.conf.sav

# nano /etc/rc.local

8. Sysctl.conf

# nano /etc/sysctl.conf

9. USB Auto Mount

https://www.axllent.org/docs/view/auto-mounting-usb-storage/
http://kissmyarch.blogspot.kr/2011/10/usb-automount.html

# nano /lib/udev/rules.d/11-my-media-automount.rules

10. audio-config

# cp audio-config /root/
# ln -sf /root/audio-config /usr/bin/
# audio-config

11. Internet Radio

# mv internet\ radios.m3u /var/lib/mpd/playlists/
# mkdir /var/lib/mpd/music/webradio
# mv *.pls /var/lib/mpd/music/webradio/
# mpc update

12. kr2mpd & ut2mpd & TTS

# curl -L https://yt-dl.org/downloads/latest/youtube-dl -o /usr/local/bin/youtube-dl
# chmod a+rx /usr/local/bin/youtube-dl
# cp kr2mpd ut2mpd tts /root/
# chmod +x /root/kr2mpd /root/ut2mpd /root/tts
# ln -sf /root/kr2mpd /root/ut2mpd /root/tts /usr/bin/

13. Read-only

# #chmod -w /sbin/init /etc/init.d/rc /lib/startpar/startpar /etc/rc.local /bin/bash /usr/share/alsa/alsa.conf.sav /usr/lib/arm-linux-gnueabi/libasound.so.2.0.0.sav /usr/bin/mpd /etc/mpd.conf.sav /usr/local/bin/upmpdcli /usr/local/etc/upmpdcli.conf
# #chmod -R -w /usr/lib/arm-linux-gnueabi/ /lib/modules/*/kernel/sound/

14. Wi-Fi

# wget http://ftp.us.debian.org/debian/pool/non-free/f/firmware-nonfree/firmware-misc-nonfree_20161130-3~bpo8+1_all.deb
# dpkg -i firmware-misc*.deb
# reboot
# lsmod
# ifconfig -a
# apt-get install wpasupplicant
# nano /etc/network/interfaces
	#auto wlan0
	#allow-hotplug wlan0
	iface wlan0 inet dhcp
	wpa-ssid wifi
	wpa-psk password
# sed -i '/auto wlan0/s/^#*//; s/wpa-ssid.*/wpa-ssid wifi/; s/wpa-psk.*/wpa-psk password/' /etc/network/interfaces
# sed -i '/auto wlan0/s/^/#/' /etc/network/interfaces

15. Copy to another disk with ext3

https://www.tldp.org/HOWTO/Hard-Disk-Upgrade/copy.html
$ sudo cp -av /source/. /dest/
$ sudo nano /dest/etc/fstab
	LABEL=rootfs / ext3  noatime,errors=remount-ro 0 1

16. Image Build

# echo "* Mino's UPnP Audio Renderer for Pogoplug 18.05" > ~/release
# nano ~/release
# mpc clear
# rm -f ~/.bash_history ; history -c
# poweroff

$ sudo fdisk -l
$ sudo dd bs=4M if=/dev/sdb of=pogo_e02_audio_renderer_18.05.img
$ zip pogo_e02_audio_renderer_18.05.zip pogo_e02_audio_renderer_18.05.img

$ sudo mv /media/parkmino/rootfs/boot/uImage /media/parkmino/rootfs/boot/uImage.e02
$ sudo mv /media/parkmino/rootfs/boot/uImage.v4 /media/parkmino/rootfs/boot/uImage
$ ls -al /media/parkmino/rootfs/boot
$ sudo dd bs=4M if=/dev/sdb of=pogo_v4_audio_renderer_18.05.img
$ zip pogo_v4_audio_renderer_18.05.zip pogo_v4_audio_renderer_18.05.img

$ sudo mv /media/parkmino/rootfs/boot/uImage /media/parkmino/rootfs/boot/uImage.v4
$ sudo mv /media/parkmino/rootfs/boot/uImage.orig /media/parkmino/rootfs/boot/uImage
$ ls -al /media/parkmino/rootfs/boot
$ sudo dd bs=4M if=/dev/sdb of=kirkwood_audio_renderer_18.05.img
$ zip kirkwood_audio_renderer_18.05.zip kirkwood_audio_renderer_18.05.img

$ sudo mv /media/parkmino/rootfs/boot/uImage /media/parkmino/rootfs/boot/uImage.orig
$ sudo mv /media/parkmino/rootfs/boot/uImage.e02 /media/parkmino/rootfs/boot/uImage
$ ls -al /media/parkmino/rootfs/boot
