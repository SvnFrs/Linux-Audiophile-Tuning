Audio Render Advanced

0. Flashing

	$ sudo fdisk -l
	$ sudo dd bs=4M if=2017-08-16-raspbian-stretch-lite.img of=/dev/sdc
	$ cp mpd mpd.conf hub-ctrl llctl icon.png audio-config kr2mpd ut2mpd /home/pi

	$ sudo raspi-config
		5 Interfacing Options > P2 SSH

	$ ssh pi@rpi_ip
	  password: raspberry

1. Update & upgrade

	sudo apt-get update
	sudo apt-get upgrade
	sudo apt-get dist-upgrade

	sudo apt-get install ntpdate

2. Configuration file

	sudo nano /boot/config.txt
		#dtparam=audio=on
		gpu_mem=16
		disable_splash=1

	cat /proc/cpuinfo
	cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq

3. Kernel option

	sudo nano /boot/cmdline.txt
		root=
		#console=serial0,115200 console=tty1
		consoleblank=0
		smsc95xx.turbo_mode=0
		elevator=noop
		selinux=0
		#dwc_otg.fiq_split_enable=0 dwc_otg.fiq_fix_enable=0
		#dwc_otg.fiq_fsm_enable=0
		#dwc_otg.fiq_enable=1 dwc_otg.fiq_fsm_enable=1 dwc_otg.fiq_fsm_mask=0x3

4. Localisation

	sudo dpkg-reconfigure locales
	sudo dpkg-reconfigure tzdata
	
5. Disable modules

	lsmod
	sudo nano /etc/modprobe.d/raspi-blacklist.conf
		blacklist uio
		blacklist uio-pdrv-genirq
		#blacklist cfg80211
		#blacklist bcm2835_gpiomem
		#blacklist fixed
		#blacklist ip_tables
		###Disable RPi3 Wi-Fi
		#blacklist brcmfmac
		#blacklist brcmutil
		###Disable RPi3 Bluetooth
		#blacklist btbcm
		#blacklist hci_uart

6. ALSA configuration
	sudo nano /lib/modprobe.d/aliases.conf
		#options snd-usb-audio index=-2

7. MPD Setup

	sudo apt-get install libcue1 libaudiofile1 libavformat57 libflac8 libmad0 libid3tag0 libmpdclient2 libmms0 libupnp6
	sudo mkdir -p /var/lib/mpd/music /var/lib/mpd/playlists /run/mpd
	sudo cp mpd /usr/bin/
	sudo cp mpd.conf /etc/
	sudo apt-get install mpc ncmpc

8. Upmpdcli Setup

9. CIFS & NFS mounting

	sudo apt-get install cifs-utils nfs-common
	sudo mkdir /mnt/cifs /mnt/nfs
	sudo ln -s /mnt/     /var/lib/mpd/music
	sudo nano /etc/fstab
		#//192.168.0.x/xxx /mnt/cifs cifs guest,ro,rsize=8192,iocharset=utf8 0 0
		#192.168.0.x:/xxx  /mnt/nfs  nfs  ro,sync,hard,intr,rsize=8192,iocharset=utf8 0 0

10. Edit /etc/fstab

	/dev/mmcblk0p1  /boot           vfat    defaults          0       2
	/dev/mmcblk0p2  /               ext4    defaults,noatime  0       1

11. Edit /etc/rc.local
	
12. Sysctl Configuration

	sudo nano /etc/sysctl.conf

12. Disabel swap

	cat /proc/swaps
	sudo systemctl disable dphys-swapfile

13. USB Mount

	https://wiki.archlinux.org/index.php/Fstab#External_devices

	sudo nano /etc/fstab
		 /dev/sda1 /mnt/usb auto defaults,nofail,x-systemd.device-timeout=1,ro 0 2
		#/dev/sda1 /mnt/usb vfat    ro 0 0
		#/dev/sda1 /mnt/usb ntfs-3g ro 0 0
	sudo nano /etc/rc.local
		systemd-udevd
	sudo systemctl daemon-reload
	sudo systemctl restart remote-fs.target
	sudo systemctl restart local-fs.target

14. Internet Radio

	sudo curl -L https://yt-dl.org/downloads/latest/youtube-dl -o /usr/local/bin/youtube-dl
	sudo chmod a+rx /usr/local/bin/youtube-dl
	sudo ln -s /home/pi/kr2mpd /home/pi/ut2mpd /usr/bin/
	sudo nano /var/lib/mpd/playlists/internet\ radio.m3u

15. audio-config

	cp audio-config /home/pi
	sudo ln -s /home/pi/audio-config /usr/bin/
	audio-config

16. Make Image

	$ echo "* Mino's UPnP Audio Renderer for Raspberry Pi 17.10" > ~/release
	$ mpc clear
	$ sudo rm -f /root/.bash_history ~/.bash_history ; history -c
	$ sudo poweroff

	$ sudo fdisk -l
	$ sudo dd bs=4M if=/dev/sdc of=raspbian_audio_renderer_17.10.img
	$ zip raspbian_audio_renderer_17.10.zip raspbian_audio_renderer_17.10.img
